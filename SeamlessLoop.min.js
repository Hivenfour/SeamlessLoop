/**
 * SeamlessLoop.js 2.0 - Reproduces seamless loops on HTML5/Javascript
 * https://github.com/Hivenfour/SeamlessLoop
 * 
 * Copyright (c) 2012 Main Software,
 * Written by DarГ­o Tejedor Rico. Contact mail: hivenfour@gmail.com
 * The source code is freely distributable under the terms of LGPL license.
 * License details at http://www.gnu.org/licenses/lgpl-3.0.txt
 */
function SeamlessLoop(){this.is={ff:Boolean(!(window.mozInnerScreenX==null)&&/firefox/.test(navigator.userAgent.toLowerCase())),ie:Boolean(document.all&&!window.opera),opera:Boolean(window.opera),chrome:Boolean(window.chrome),safari:Boolean(!window.chrome&&/safari/.test(navigator.userAgent.toLowerCase())&&window.getComputedStyle&&!window.globalStorage&&!window.opera)};console.debug("ff: "+this.is.ff);console.debug("ie: "+this.is.ie);console.debug("opera: "+this.is.opera);console.debug("chrome: "+this.is.chrome);console.debug("safari: "+this.is.safari);this._total=0;this._load=0;this.cb_loaded;this.cb_loaded_flag=new Boolean();this.timeout;this.playDelay=-30;this.stopDelay=30;if(this.is.chrome){this.playDelay=-25}if(this.is.chrome){this.stopDelay=25}if(this.is.ff){this.playDelay=-25}if(this.is.ff){this.stopDelay=85}if(this.is.opera){this.playDelay=5}if(this.is.opera){this.stopDelay=0}console.debug(this.playDelay+", "+this.stopDelay);this.next=1;this.audios=new Array();this.actual=new Array();this.dropOld=new Boolean();this.old;this._volume=1;var a=this;this._eventCanplaythrough=function(b){if(b==false){b=true;a._load++;if(a._load==a._total){a.loaded=true;if(a.cb_loaded_flag==true){a.cb_loaded();a.cb_loaded_flag=false}}}};this._eventPlaying=function(b){setTimeout(function(){b.pause();try{b.currentTime=0}catch(c){console.debug(c.message)}},a.stopDelay);if(a.dropOld==true){setTimeout(function(){if(a.old.paused==false){a.old.pause();try{a.old.currentTime=0}catch(c){console.debug(c.message)}}},a.stopDelay);a.dropOld=false}};this._eventEnded=function(b){b.volume=this._volume};this.doLoop=function(){var d=(this.next==1?"_1":"_2");var b=(this.next==1?"_2":"_1");var c=this;this.timeout=setTimeout(function(){c.doLoop()},this.actual._length+this.playDelay);if(this.is.opera){this.actual[b].pause()}this.actual[d].play();this.next*=-1};this.isLoaded=function(){return Boolean(this._load==this._total)}}SeamlessLoop.prototype.start=function(a){if(a!=""){this.actual=this.audios[a]}this.doLoop()};SeamlessLoop.prototype.volume=function(a){if(typeof a!="undefined"&&this.timeout){this.actual._1.volume=a;this.actual._2.volume=a;this._volume=a}return a};SeamlessLoop.prototype.stop=function(){if(!this.timeout){return}clearTimeout(this.timeout);this.actual._1.currentTime=0;this.actual._1.pause();this.actual._2.currentTime=0;this.actual._2.pause()};SeamlessLoop.prototype.callback=function(a){this.cb_loaded=a;if(this.isLoaded()==true){a()}else{this.cb_loaded_flag=true}};SeamlessLoop.prototype.update=function(c,b){var a=(this.next==1?"_2":"_1");this.old=this.actual[a];this.actual=this.audios[c];if(b==false){if(this.old.paused==false){this.dropOld=true;if(this.is.opera){this.old.pause()}}clearTimeout(this.timeout);this.doLoop()}};SeamlessLoop.prototype.addUri=function(c,b,d){this.audios[d]=new Array();this.audios[d]._length=b;var a=this;this.audios[d]._1_isLoaded=new Boolean();this.audios[d]._2_isLoaded=new Boolean();this.audios[d]._1=new Audio(c);this.audios[d]._2=new Audio(c);this._total++;this.audios[d]._1.addEventListener("canplaythrough",function(){a._eventCanplaythrough(a.audios[d]._1_isLoaded)});this.audios[d]._2.addEventListener("canplaythrough",function(){a._eventCanplaythrough(a.audios[d]._2_isLoaded)});this.audios[d]._1.addEventListener("playing",function(){a._eventPlaying(a.audios[d]._2)});this.audios[d]._2.addEventListener("playing",function(){a._eventPlaying(a.audios[d]._1)});this.audios[d]._1.addEventListener("ended",function(){a._eventEnded(a.audios[d]._1)});this.audios[d]._2.addEventListener("ended",function(){a._eventEnded(a.audios[d]._2)});this.audios[d]._1.load();this.audios[d]._2.load();this.audios[d]._1.volume=this._volume;this.audios[d]._2.volume=this._volume};
